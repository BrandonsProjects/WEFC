<?xml version="1.0" encoding="UTF-8"?>
<Subscription xmlns="http://schemas.microsoft.com/2006/03/windows/events/subscription">
    <SubscriptionId>Antimalware</SubscriptionId>
    <SubscriptionType>SourceInitiated</SubscriptionType>
    <Description>Important User and Security Group Events from all Domain Computers and Domain Controllers</Description>
    <Enabled>true</Enabled>
    <Uri>http://schemas.microsoft.com/wbem/wsman/1/windows/EventLog</Uri>
    <ConfigurationMode>Custom</ConfigurationMode>
    <Delivery Mode="Push">
		<Batching>
			<MaxLatencyTime>1000</MaxLatencyTime>
		</Batching>
		<PushSettings>
			<Heartbeat Interval="60000"/>
		</PushSettings>
	</Delivery>
	<Query>
		<![CDATA[
			<QueryList>
				<!-- Anti-malware *old* events, but only detect events (cuts down noise) -->
				<Query Id="0" Path="System">
					<Select Path="System">*[System[Provider[@Name='Microsoft Antimalware'] and (EventID &gt;= 1116 and EventID &lt;= 1119)]]</Select>
				</Query>

				<!-- AppLocker EXE events or Script events -->
				<Query Id="1" Path="Microsoft-Windows-AppLocker/EXE and DLL">
					<Select Path="Microsoft-Windows-AppLocker/EXE and DLL">*[UserData[RuleAndFileData[PolicyName="EXE"]]]</Select>
					<Select Path="Microsoft-Windows-AppLocker/MSI and Script">*</Select>
				</Query>

				<!-- AppLocker packaged (Modern UI) app execution -->
				<Query Id="2" Path="Microsoft-Windows-AppLocker/Packaged app-Execution">
					<Select Path="Microsoft-Windows-AppLocker/Packaged app-Execution">*</Select>
					<Suppress Path="Microsoft-Windows-AppLocker/Packaged app-Execution">*[EventData[Data[@Name='User_Data.Package']='MICROSOFT.WINDOWS.CONTENTDELIVERYMANAGER']]</Suppress>
				</Query>

				<!-- AppLocker packaged (Modern UI) app installation -->
				<Query Id="3" Path="Microsoft-Windows-AppLocker/Packaged app-Deployment">
					<Select Path="Microsoft-Windows-AppLocker/Packaged app-Deployment">*</Select>
				</Query>

				<!-- EMET events -->
				<Query Id="4" Path="Application">
					<Select Path="Application">*[System[Provider[@Name='EMET']]]</Select>
				</Query>

				<!-- Modern Windows Defender event provider Detection events (1006-1009) and (1116-1119) -->
				<Query Id="5" Path="Microsoft-Windows-Windows Defender/Operational">
					<Select Path="Microsoft-Windows-Windows Defender/Operational">*[System[( (EventID &gt;= 1006 and EventID &lt;= 1009) )]]</Select>
					<Select Path="Microsoft-Windows-Windows Defender/Operational">*[System[( (EventID &gt;= 1116 and EventID &lt;= 1119) )]]</Select>
					<!-- Modern Windows Defender event provider Updates events (2000-2003) -->
					<Select Path="Microsoft-Windows-Windows Defender/Operational">*[System[( (EventID &gt;= 2000 and EventID &lt;= 2003) )]]</Select>
				</Query>
			</QueryList>
		]]>
	</Query>
	<ReadExistingEvents>false</ReadExistingEvents>
	<TransportName>HTTP</TransportName>
	<ContentFormat>RenderedText</ContentFormat>
	<Locale Language="en-US"/>
	<LogFile>ForwardedEvents</LogFile>
	<PublisherName>Microsoft-Windows-EventCollector</PublisherName>
	<AllowedSourceNonDomainComputers></AllowedSourceNonDomainComputers>
	<!-- if you have multiple domains, you will need to get the identifiers of all the domains connecting to your Event Collector and put them below. the easiest way is just to make a new subscription from the GUI and export it, then cut and paste that field in. 
	The SDDL below is just the well known identifiers for "Domain Users" and "Domain Computers" -->                
	<AllowedSourceDomainComputers>O:NSG:BAD:P(A;;GA;;;DC)(A;;GA;;;DD)S:</AllowedSourceDomainComputers>
</Subscription>
